import{r as l,f as b,B as c,J as u,E as o,D as i,M as _,K as k,O as y,Q as g}from"./index.ebab3077.js";import{Q as S}from"./QInput.1ffec7f9.js";import{Q as x}from"./QForm.4d4f0ba4.js";import{u as E}from"./use-quasar.9a32f925.js";import"./focus-manager.3d77c9c9.js";const C={class:"q-pa-md"},z={__name:"SystemPage",setup(Q){const s=E(),r=l(localStorage.getItem("jwtToken")||""),p=l([]),d=l([]);function f(e){switch(e==null?void 0:e.substr(0,8)){case"[boolin]":return{type:"bool",description:e.substr(8)};case"[string]":return{type:"text",description:e.substr(8)};case"[passwd]":return{type:"password",description:e.substr(8)};default:return{type:"text",description:e}}}async function h(e){try{const t=await fetch("https://api.caronon.com/api/system/setting",{method:"PUT",body:JSON.stringify({name:e.name,value:e.value}),headers:{Authorization:`Bearer ${r.value}`,"Content-Type":"application/json"}}),a=t.ok?await t.json():`Error ${t.status} - ${(await t.text()).substring(0,256)}`;t.ok?s.notify({message:"Saved",type:"positive"}):s.notify({message:a,type:"negative"})}catch(t){s.notify({message:t.message,type:"negative"})}}async function v(e){if(!!confirm(`Are you sure? ${e.name} will be deleted!`))try{const t=await fetch(`https://api.caronon.com/api/system/setting?name=${e.name}`,{method:"DELETE",headers:{Authorization:`Bearer ${r.value}`}}),a=t.ok?await t.json():`Error ${t.status} - ${(await t.text()).substring(0,256)}`;t.ok?(s.notify({message:"Deleted",type:"positive"}),await m()):s.notify({message:a,type:"negative"})}catch(t){s.notify({message:t.message,type:"negative"})}}async function m(){try{const e=await fetch("https://api.caronon.com/api/system/setting",{method:"GET",headers:{Authorization:`Bearer ${r.value}`}}),t=e.ok?await e.json():`Error ${e.status} - ${(await e.text()).substring(0,256)}`;e.ok?(d.value=t.data,p.value=d.value.map(function(a){const n=f(a.description);return{name:a.name,value:a.value,type:n.type,description:n.description}})):s.notify({message:t,type:"negative"})}catch(e){s.notify({message:e.message,type:"negative"})}}function w(){s.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Resetted"})}function $(){s.notify({color:"green-4",textColor:"white",icon:"cloud_done",message:"Submitted"})}return b(async()=>{m()}),(e,t)=>(c(),u("div",C,[o(x,{onSubmit:$,onReset:w,class:"q-gutter-md"},{default:i(()=>[(c(!0),u(_,null,k(p.value,a=>(c(),u("div",{key:a.name},[o(S,{filled:"",modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,label:a.name,hint:a.description,"lazy-rules":"",type:a.type,rules:[n=>n&&n.length>0||"Please type something"]},{after:i(()=>[o(y,{flat:"","no-caps":"",style:{padding:"0"},title:"Save",onClick:n=>h(a)},{default:i(()=>[o(g,{name:"save",color:"primary"})]),_:2},1032,["onClick"]),o(y,{flat:"","no-caps":"",style:{padding:"0"},title:"Delete",onClick:n=>v(a)},{default:i(()=>[o(g,{name:"delete",color:"negative"})]),_:2},1032,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","label","hint","type","rules"])]))),128))]),_:1})]))}};export{z as default};
